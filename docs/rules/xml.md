---
layout: default
title: XML
parent: Rules
---

# XML
{: .no_toc }


## Оглавление
{: .no_toc .text-delta }

1. TOC
{:toc}

---




### Внешняя сущность XML (XXE)

<span class="d-inline-block p-2 mr-1 v-align-middle bg-red-000"></span>Несоответствующий код:


```java
# Несоответствующий код
xml_data = params[:xml_data]
xml_doc = Nokogiri::XML(xml_data)

# Обработка XML-документа
```

В этом несовместимом коде XML-данные получаются из объекта params и передаются непосредственно парсеру Nokogiri::XML для обработки. Этот код уязвим для различных атак, связанных с XML, таких как атаки XML External Entity (XXE) или Billion Laughs. Злоумышленники могут предоставить вредоносную полезную нагрузку XML, которая может привести к отказу в обслуживании, раскрытию конфиденциальной информации или другим угрозам безопасности.







<span class="d-inline-block p-2 mr-1 v-align-middle bg-green-000"></span>Соответствующий код:


```java
# Соответствующий код
xml_data = params[:xml_data]

begin
  xml_doc = Nokogiri::XML::Document.parse(xml_data) do |config|
    config.strict
    config.nonet
  end

  # Обработка XML-документа
  
rescue Nokogiri::XML::SyntaxError => e
  # Обработка ошибок парсинга XML
  logger.error "Error parsing XML: #{e}"
end
```


В совместимом коде XML-данные по-прежнему получаются из объекта params, но они разбираются с помощью метода Nokogiri::XML::Document.parse с дополнительными настройками безопасности. Конфигурация strict обеспечивает строгий разбор XML-документа, а конфигурация nonet отключает связанные с сетью функции, такие как расширение сущностей, ссылки на внешние сущности и обработка DTD. Эти настройки помогают устранить уязвимости, связанные с XML, снижая риск появления вредоносных полезных нагрузок и предотвращая разбор внешних сущностей.

Важно отметить, что уязвимости в обработке XML могут иметь различные проявления и требовать различных мер по их устранению в зависимости от конкретного контекста и требований. Приведенный здесь код совместимости ориентирован на общую безопасность разбора XML, однако в зависимости от конкретного случая использования могут потребоваться дополнительные меры.

Другие меры безопасности, которые вы можете применить для снижения уязвимостей, связанных с XML, включают:

* Выполнение проверки и санации ввода для обеспечения соответствия XML-данных ожидаемой структуре и формату.
* Применение проверки схемы XML для проверки структуры и типов данных XML-документа.
* Использование библиотек безопасности XML или фреймворков, обеспечивающих такие функции, как проверка подписи XML и шифрование.
* Внедрение соответствующих средств контроля доступа и принципов наименьших привилегий для ограничения доступа к конфиденциальной информации при обработке XML.

Применяя эти меры безопасности и придерживаясь лучших практик, вы сможете уменьшить уязвимости, связанные с XML, и повысить общую безопасность вашего приложения при обработке данных XML.



