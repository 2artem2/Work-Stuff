---
layout: default
title: Ruby on Rails
parent: Rules
---

# Ruby on Rails
{: .no_toc }


## Оглавление
{: .no_toc .text-delta }

1. TOC
{:toc}

---




### Межсайтовый скриптинг (XSS)

<span class="d-inline-block p-2 mr-1 v-align-middle bg-red-000"></span>Несоответствующий код:


```java
// Несоответствующий код:
def create
  @comment = Comment.new(comment_params)
  
  if @comment.save
    redirect_to @comment
  else
    render 'new'
  end
end
```

В этом несоответствующем коде действие create обрабатывает создание комментария в Ruby on Rails. Однако в нем не предусмотрено никакой санации или проверки вводимых пользователем данных. Следовательно, если злоумышленник отправит комментарий с вредоносным HTML- или JavaScript-кодом, то при отображении комментария он будет отображен как есть, что приведет к возникновению уязвимости межсайтового скриптинга (XSS).






<span class="d-inline-block p-2 mr-1 v-align-middle bg-green-000"></span>Соответствующий код:


```java
// Соответствующий код
def create
  @comment = Comment.new(comment_params)
  
  if @comment.save
    redirect_to @comment
  else
    flash.now[:error] = "Comment creation failed."
    render 'new'
  end
end
```


В совместимом коде новый комментарий создается, как и раньше, но вместо отображения шаблона 'new' при возникновении ошибки устанавливается flash-сообщение, уведомляющее пользователя об ошибке. Благодаря использованию механизма flash.now сообщение отображается в рамках одного и того же цикла запрос-ответ, что гарантирует, что пользовательский ввод не будет напрямую возвращен в браузер, и снижает риск XSS-атак.

Чтобы еще больше усилить защиту от XSS-уязвимостей в Ruby on Rails, вы можете использовать встроенные механизмы экранирования HTML, предоставляемые фреймворком. Например, при выводе пользовательского контента в шаблоне представления вы можете использовать метод h или html_escape для экранирования любых HTML-сущностей:

```
<%= h @comment.body %>
```


Это гарантирует, что содержимое отображается в виде обычного текста, а любые HTML-теги или специальные символы будут правильно экранированы, что предотвратит их выполнение в качестве кода.

Помимо санации ввода и экранирования HTML, другие меры безопасности, которые вы можете применить в Ruby on Rails для защиты от XSS-уязвимостей, включают:

* Использование помощников форм Rails, таких как form_for или form_tag, которые автоматически применяют необходимое экранирование и защищают от CSRF-атак.
* Внедрение политик безопасности содержимого (CSP) для контроля типов содержимого, разрешенных для загрузки и выполнения на веб-страницах.
* Применение надлежащей кодировки вывода или использование специальных механизмов рендеринга, таких как raw или html_safe, при рендеринге содержимого, которое должно рассматриваться как доверенный HTML.

Правильно санируя пользовательский ввод, применяя экранирование HTML и реализуя меры безопасности во всем вашем Rails-приложении, вы сможете эффективно устранить XSS-уязвимости и повысить общую безопасность вашего веб-приложения.




