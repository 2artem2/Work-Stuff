---
layout: default
title: Virtual Patching
parent: Operate
---

# Виртуальное исправление
{: .no_toc }

## Оглавление
{: .no_toc .text-delta }

1. TOC
{:toc}

---


Виртуальное исправление - это техника безопасности, используемая в DevSecOps для обеспечения временной защиты от известных уязвимостей в программных приложениях или системах. Виртуальное исправление подразумевает использование политик безопасности, правил или фильтров, которые применяются к сетевому трафику, системным журналам или коду приложений для предотвращения использования известных уязвимостей.

Виртуальное исправление может использоваться в тех случаях, когда исправление, предоставляемое поставщиком, недоступно или когда исправление нецелесообразно из-за операционных ограничений или потребностей бизнеса. Оно позволяет организациям быстро и легко защитить свои системы от известных уязвимостей без необходимости отключать приложение или систему от сети или вносить изменения в основной код.

Некоторые из ключевых преимуществ виртуального исправления в DevSecOps включают:

1. Снижение риска эксплуатации: Применяя виртуальные патчи к известным уязвимостям, организации могут снизить риск использования этих уязвимостей злоумышленниками.

2. Повышение уровня безопасности: Виртуальные исправления позволяют организациям быстро и легко защитить свои системы от известных уязвимостей, повышая общую степень безопасности.

3. Сокращение времени простоя: Виртуальное исправление можно внедрить быстро и легко, не требуя простоя системы и не нарушая бизнес-операции.

4. Повышение соответствия нормативным требованиям: Виртуальное исправление может помочь организациям выполнить нормативные требования по своевременному устранению известных уязвимостей.

Виртуальное исправление может быть реализовано с помощью различных технологий, включая системы предотвращения вторжений (IPS), брандмауэры веб-приложений (WAF) и сетевые устройства безопасности. Оно также может быть реализовано с помощью автоматизированных политик безопасности или сценариев, применяемых к системам и приложениям.






## Сборник логов



### Splunk

1- Настройте входы данных: Настройте входы данных для получения данных из различных источников, таких как сетевые устройства, серверы и приложения. Настройте входы данных для следующего:

* Syslog
* Журналы событий Windows
* Сетевой трафик (с помощью дополнения Splunk Stream)
* Журналы облачных платформ (например, AWS CloudTrail, Azure Audit Logs).

2- Создайте индексы: Создайте индексы для хранения данных из настроенных входов данных. Индексы можно создавать на основе типов данных, таких как события безопасности, сетевой трафик или журналы приложений.

3- Создайте панель управления: Создайте приборную панель для визуализации данных, собранных с помощью входов данных. На приборной панели можно отобразить следующее:

* События и оповещения в реальном времени
* графики и диаграммы трендов
* Отчеты и показатели безопасности.
 
4- Создайте образец правила для обнаружения: Создайте образец правила для обнаружения атаки или инцидента безопасности. Например, создайте правило для обнаружения неудачных попыток входа в веб-приложение. Ниже описано, как создать правило в Splunk:

* Создайте поисковый запрос: Создайте поисковый запрос для выявления неудачных попыток входа в систему в журналах веб-приложений. Например:


```
sourcetype=apache_access combined=*login* status=401 | stats count by clientip
```



## Виртуальное исправление

Виртуальное исправление - это механизм безопасности, который помогает защитить приложения и системы от известных уязвимостей, пока разработчики работают над созданием и тестированием патча для устранения уязвимости. Он включает в себя реализацию временного программного решения, которое блокирует или смягчает векторы атак, которые могут быть использованы для эксплуатации уязвимости. Это делается путем создания правил или политик в программном обеспечении безопасности, таком как брандмауэры веб-приложений или системы обнаружения/предотвращения вторжений, которые блокируют или предупреждают о вредоносном трафике, пытающемся использовать уязвимость.

Виртуальное исправление может стать эффективным способом быстрой и временной защиты систем от известных уязвимостей, особенно тех, которые могут быть активно атакованы злоумышленниками. Кроме того, это дает организациям время для тестирования и внедрения постоянных исправлений, не оставляя свои системы незащищенными от атак.





| Имя    | Язык   | 
|:---------------|:---------------------|
| `Java` | Contrast Security, Sqreen, AppSealing, JShielder |
| `.NET	` | Contrast Security, Sqreen, Nettitude, Antimalware-Research |
| `Node.js	` | Sqreen, RASP.js, Jscrambler, nexploit |
| `Python` | RASP-Protect, PyArmor, Striker, nexploit |
| `PHP` | Sqreen, RIPS Technologies, RSAS, nexploit |
| `Ruby` | Sqreen, RASP-Ruby, nexploit |




пример правила RASP для устранения уязвимости SQL Injection:

```
import javax.servlet.http.HttpServletRequest;
import com.rasp.scanner.RASP;
import com.rasp.scanner.ELExpression;

public class SQLInjectionRule {

  public static void checkSQLInjection(HttpServletRequest request) {

    // Получите входные параметры из запроса
    String username = request.getParameter("username");
    String password = request.getParameter("password");

    // Проверка на SQL-инъекции в параметре имени пользователя
    if (RASP.isSQLInjection(username)) {
      // Зарегистрируйте попытку атаки
      RASP.log("SQL injection detected in username parameter");
      // Заблокировать запрос
      RASP.blockRequest("SQL injection detected");
    }

    // Проверка на SQL-инъекцию в параметре пароля
    if (RASP.isSQLInjection(password)) {
      // Зарегистрируйте попытку атаки
      RASP.log("SQL injection detected in password parameter");
      // Заблокировать запрос
      RASP.blockRequest("SQL injection detected");
    }
  }
}
```

Это правило проверяет наличие атак SQL-инъекций в параметрах "имя пользователя" и "пароль" HTTP-запроса. Если атака обнаружена, правило регистрирует попытку и блокирует запрос.



Шпаргалка по правилам предотвращения уязвимостей OWASP Top 10

```

 Тип OWASP               Уязвимость                                           Правило/политика

Инъекция                Инъекция SQL                                             /^[^']*$/i
                        Командная инъекция                                       /^[^']*$/i
                        Инъекция LDAP                                            /^[^']*$/i
                        Инъекция XPath                                           /^[^']*$/i
                        Инъекция команд ОС                                       /^[^']*$/i
                        Expression Language Injection                            /^[^']*$/i

Поломки                 Нарушенная аутентификация                                Внедрение 2FA или MFA
Аутентификация          Управление паролями                                      Сложность паролей и политика истечения срока действия
                        Профилактика Brute Force                                 Политика блокировки учетной записи

Чувствительные данные   Раскрытие чувствительных данных                          Шифрование в пути и в состоянии покоя
Раскрытие               Подделка межсайтовых запросов (CSRF)                     CSRF-токены для всех форм
                        Нарушенный контроль доступа                              Управление доступом на основе ролей

Неправильная конфигурация         Неправильная конфигурация                    Регулярные оценки безопасности и проверки на соответствие требованиям
системы безопасности              системы безопасности

                       Небезопасное криптографическое хранилище                  Сильные криптографические алгоритмы и управление ключами
                       Недостаточное протоколирование и мониторинг               Регистрируйте все события, имеющие отношение к безопасности
                       Недостаточная защита от атак                              Брандмауэр приложений (WAF) для предотвращения атак OWASP Top 10

Межсайтовые            Межсайтовый скриптинг (XSS)                               Кодирование пользовательского ввода
сценарии
                       Небезопасные прямые ссылки на объекты                     Проверка контроля доступа и валидация ввода

Небезопасные           Использование компонентов                                 Регулярные исправления и обновления
компоненты             с известными уязвимостями

```


### SQL-инъекция

#### RASP (Самозащита приложений во время выполнения)

```
when {
    event.type == "http" &&
    event.action == "param_value" &&
    http.param.name.matches("(?i).*((select|union|insert|update|delete|from|where|order by|group by|having|or|and).*)")
} then {
    block();
    raise "SQL Injection detected in param: " + http.param.name;
}
```

#### WAF (Файрвол веб-приложений)

```
SecRule ARGS "@rx ^[a-zA-Z0-9\s]+$" \
    "id:1,\
    phase:2,\
    t:none,\
    deny,\
    msg:'Possible SQL Injection Attack'"
```

### Инъекция команд

```
when {
    event.type == "http" &&
    event.action == "param_value" &&
    http.param.name.matches("(?i).*((;|&|`|\\|\\||\\||&&).*)")
} then {
    block();
    raise "Command Injection detected in param: " + http.param.name;
}
```

#### RASP (Самозащита приложений во время выполнения)

```
SecRule ARGS "@rx ^[a-zA-Z0-9\s]+$" \
    "id:2,\
    phase:2,\
    t:none,\
    deny,\
    msg:'Possible Command Injection Attack'"
```

#### WAF (Файрвол веб-приложений)

```
SecRule ARGS "@rx ^[a-zA-Z0-9\s]+$" \
    "id:2,\
    phase:2,\
    t:none,\
    deny,\
    msg:'Possible Command Injection Attack'"
```


### XSS (Межсайтовый скриптинг)

#### RASP (Самозащита приложений во время выполнения)

```
when {
    event.type == "http" &&
    event.action == "param_value" &&
    http.param.value.matches("(?i).*((<script|<img|alert|prompt|document.cookie|window.location|onerror|onload).*)")
} then {
    block();
    raise "XSS detected in param: " + http.param.name;
}
```

#### WAF

##### Правило предотвращения тегов сценариев


```
SecRule ARGS|XML:/* "@rx <script.*?>" \
    "id:3,\
    phase:2,\
    t:none,\
    deny,\
    msg:'Possible XSS Attack via Script Tag'"
```

##### Правило предотвращения инъекций атрибутов


```
SecRule ARGS|XML:/* "(<|&lt;)script[\s\S]+?=" \
    "id:4,\
    phase:2,\
    t:none,\
    deny,\
    msg:'Possible XSS Attack via Attribute Injection'"

```
